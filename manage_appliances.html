<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Appliances | WE CMS</title>    <!-- Add Chart.js library -->
    <!-- <script src="links/chart.js"></script> -->
    <!-- Replace your local Chart.js reference with this CDN version -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add Font Awesome for icons - use CDN as backup -->
    <link rel="stylesheet" href="fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
      :root {
        --primary-color: #2f3e46;
        --secondary-color: #3d5a80;
        --tertiary-color: #a8dadc;
        --success-color: #2a9d8f;
        --danger-color: #e63946;
        --warning-color: #ee9b00;
        --light-color: #f4f4f4;
        --dark-color: #333;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        display: flex;
        color: var(--dark-color);
      }

      .sidebar {
        width: 250px;
        background-color: var(--primary-color);
        color: #fff;
        height: 100vh;
        padding: 20px;
        position: fixed;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        z-index: 100;
      }

      .sidebar h2 {
        margin-bottom: 30px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .sidebar h2 i {
        font-size: 1.5rem;
        color: var(--tertiary-color);
      }

      .sidebar a {
        color: #fff;
        display: flex;
        align-items: center;
        margin: 15px 0;
        text-decoration: none;
        padding: 12px 15px;
        border-radius: 6px;
        transition: all 0.3s;
        gap: 10px;
      }

      .sidebar a i {
        width: 22px;
      }

      .sidebar a:hover,
      .sidebar a.active {
        background-color: var(--secondary-color);
        transform: translateX(5px);
      }

      .main {
        flex: 1;
        padding: 25px;
        margin-left: 250px;
        transition: all 0.3s ease;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        background: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .header h1 {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--primary-color);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .header h1 i {
        font-size: 1.6rem;
        color: var(--secondary-color);
      }

      .card {
        background-color: #fff;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
      }

      .card h3 {
        color: var(--primary-color);
        margin-bottom: 20px;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .card h3 i {
        font-size: 1.5rem;
      }

      .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .form-group {
        flex: 1;
        min-width: 200px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark-color);
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        transition: all 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus {
        border-color: var(--tertiary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(168, 218, 220, 0.25);
      }

      .btn {
        padding: 10px 20px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
      }

      .btn i {
        font-size: 1rem;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--secondary-color);
        transform: translateY(-2px);
      }

      .btn-secondary {
        background-color: var(--light-color);
        color: var(--dark-color);
      }

      .btn-secondary:hover {
        background-color: #e9ecef;
        transform: translateY(-2px);
      }

      .btn-danger {
        background-color: var(--danger-color);
        color: white;
      }

      .btn-danger:hover {
        background-color: #dc3545;
        transform: translateY(-2px);
      }

      .btn-success {
        background-color: var(--success-color);
        color: white;
      }

      .btn-success:hover {
        background-color: #218778;
        transform: translateY(-2px);
      }

      .appliance-table {
        width: 100%;
        border-collapse: collapse;
      }

      .appliance-table th,
      .appliance-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }

      .appliance-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        color: var(--dark-color);
      }

      .appliance-table tr:hover {
        background-color: #f8f9fa;
      }

      .actions {
        display: flex;
        gap: 10px;
      }

      .action-btn {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
      }

      .edit-btn {
        background-color: var(--tertiary-color);
        color: var(--dark-color);
      }

      .edit-btn:hover {
        background-color: #9acdcf;
        transform: translateY(-2px);
      }

      .delete-btn {
        background-color: #f8d7da;
        color: var(--danger-color);
      }

      .delete-btn:hover {
        background-color: #f5c2c7;
        transform: translateY(-2px);
      }

      .appliance-category {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .category-kitchen {
        background-color: #d8f3dc;
        color: #2a9d8f;
      }

      .category-entertainment {
        background-color: #d5e5ff;
        color: #457b9d;
      }

      .category-climate {
        background-color: #fde6d2;
        color: #e76f51;
      }

      .category-lighting {
        background-color: #fff3b0;
        color: #ee9b00;
      }

      .category-other {
        background-color: #e9ecef;
        color: #6c757d;
      }

      .status-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
      }

      .status-active {
        background-color: var(--success-color);
      }

      .status-inactive {
        background-color: #adb5bd;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s;
      }

      .modal-content {
        background-color: #fff;
        margin: 10% auto;
        padding: 25px;
        border-radius: 10px;
        width: 80%;
        max-width: 600px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h3 {
        color: var(--primary-color);
        margin: 0;
      }

      .close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
      }

      .close:hover {
        color: var(--dark-color);
      }

      .modal-footer {
        margin-top: 20px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s;
        border-left: 4px solid var(--primary-color);
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .icon-appliances {
        background-color: #e9ecef;
        color: var(--primary-color);
      }

      .icon-consumption {
        background-color: #d5e5ff;
        color: #457b9d;
      }

      .icon-cost {
        background-color: #fde6d2;
        color: #e76f51;
      }

      .stat-info h4 {
        color: #6c757d;
        font-size: 0.9rem;
        font-weight: 500;
        margin-bottom: 5px;
      }

      .stat-info p {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--dark-color);
        margin: 0;
      }

      .tab-container {
        margin-bottom: 20px;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .tab {
        padding: 10px 20px;
        background-color: #f8f9fa;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        color: var(--dark-color);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tab:hover {
        background-color: #e9ecef;
      }

      .tab.active {
        background-color: var(--primary-color);
        color: white;
      }

      .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
      }

      .chart-card {
        overflow: hidden;
      }

      .chart-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .chart-period-btn {
        background: #f8f9fa;
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s;
      }

      .chart-period-btn:hover {
        background: #e9ecef;
      }      .chart-period-btn.active {
        background-color: var(--primary-color);
        color: white;
      }      .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        background-color: rgba(248, 249, 250, 0.5);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .chart-split {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
      }
      
      /* Chart error message styling */
      .chart-error {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        height: 100%;
        width: 100%;
        color: var(--danger-color);
        gap: 10px;
      }
      
      .chart-error i {
        font-size: 2rem;
      }
      
      /* Appliance comparison chart styles */
      .chart-type-selector {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }
      
      .chart-type-btn {
        background: #f8f9fa;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      
      .chart-type-btn:hover {
        background: #e9ecef;
        transform: translateY(-2px);
      }
      
      .chart-type-btn.active {
        background-color: var(--primary-color);
        color: white;
      }
      
      .chart-legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 15px;
      }
      
      .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
      }
      
      .legend-color {
        width: 15px;
        height: 15px;
        border-radius: 3px;
        display: inline-block;
      }

      .chart-half {
        flex: 1;
        min-width: 300px;
      }

      .chart-half h4 {
        margin-bottom: 15px;
        color: var(--primary-color);
        font-size: 1.1rem;
      }

      .savings-stats {
        margin-top: 15px;
      }

      .saving-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        background-color: #f8f9fa;
        transition: all 0.3s;
      }

      .saving-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .saving-icon {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      .saving-item:nth-child(1) .saving-icon {
        background-color: #fde6d2;
        color: #e76f51;
      }

      .saving-item:nth-child(2) .saving-icon {
        background-color: #d8f3dc;
        color: #2a9d8f;
      }

      .saving-item:nth-child(3) .saving-icon {
        background-color: #fff3b0;
        color: #ee9b00;
      }

      .saving-title {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 5px;
      }

      .saving-desc {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 5px;
      }

      .saving-value {
        font-weight: 700;
        color: var(--success-color);
        font-size: 1.1rem;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      
      /* Toast notification styles */
      .toast-message {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        z-index: 9999;
        transition: opacity 0.5s;
        animation: slideUp 0.3s ease-out;
      }
      
      .toast-message.success {
        background-color: var(--success-color);
      }
      
      .toast-message.error {
        background-color: var(--danger-color);
      }
      
      .toast-message i {
        font-size: 1.2rem;
      }
      
      @keyframes slideUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @media screen and (max-width: 1024px) {
        .sidebar {
          width: 80px;
        }

        .sidebar h2 span,
        .sidebar a span {
          display: none;
        }

        .main {
          margin-left: 80px;
        }
      }

      @media screen and (max-width: 768px) {
        .form-row {
          flex-direction: column;
          gap: 15px;
        }

        .form-group {
          min-width: 100%;
        }

        .appliance-table {
          display: block;
          overflow-x: auto;
        }
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <h2><i class="fas fa-bolt"></i> <span>WE CMS</span></h2>
      <a href="dashboard.html"
        ><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a
      >
      <a href="history.html"
        ><i class="fas fa-history"></i> <span>History</span></a
      >
      <a href="tips.html"><i class="fas fa-lightbulb"></i> <span>Tips</span></a>
      <a href="manage_appliances.html" class="active"
        ><i class="fas fa-plug"></i> <span>Appliances</span></a
      >
      <a href="settings.html"
        ><i class="fas fa-cog"></i> <span>Settings</span></a
      >
      <a href="index.html" style="margin-top: auto"
        ><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a
      >
    </div>

    <div class="main">
      <div class="header">
        <h1><i class="fas fa-plug"></i> Manage Appliances</h1>
        <!-- <div class="user-info">
          <div class="info">
            <div class="name">John Doe</div>
            <div class="role">Residential User</div>
          </div>
          <img src="images/user-avatar.jpg" alt="User Avatar" />
        </div> -->
      </div>

      <div class="summary-stats">
        <div class="stat-card">
          <div class="stat-icon icon-appliances">
            <i class="fas fa-plug"></i>
          </div>
          <div class="stat-info">
            <h4>Total Appliances</h4>
            <p>8</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon icon-consumption">
            <i class="fas fa-bolt"></i>
          </div>
          <div class="stat-info">
            <h4>Monthly Consumption</h4>
            <p>357 kWh</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon icon-cost">
            <i class="fas fa-peso-sign"></i>
          </div>
          <div class="stat-info">
            <h4>Estimated Monthly Cost</h4>
            <p>₱3,213.00</p>
          </div>
        </div>
      </div>

      <!-- Add this right after the summary-stats section and before the "Add New Appliance" card -->

      <div class="card-container">
        <div class="card chart-card">
          <h3><i class="fas fa-chart-line"></i> Electricity Consumption</h3>
          <div class="chart-controls">
            <button class="chart-period-btn active" data-period="daily">
              Daily
            </button>
            <button class="chart-period-btn" data-period="weekly">
              Weekly
            </button>
            <button class="chart-period-btn" data-period="monthly">
              Monthly
            </button>
          </div>
          <div class="chart-container">
            <canvas id="consumptionChart"></canvas>
          </div>
        </div>

        <div class="card chart-card">
          <h3><i class="fas fa-coins"></i> Electricity Cost</h3>
          <div class="chart-controls">
            <button class="chart-period-btn active" data-period="daily">
              Daily
            </button>
            <button class="chart-period-btn" data-period="weekly">
              Weekly
            </button>
            <button class="chart-period-btn" data-period="monthly">
              Monthly
            </button>
          </div>
          <div class="chart-container">
            <canvas id="costChart"></canvas>
          </div>
        </div>      </div>
      
      <div class="card chart-card">
        <h3><i class="fas fa-chart-pie"></i> Consumption by Category</h3>
        <div class="chart-split">
          <div class="chart-half">
            <canvas id="categoryPieChart"></canvas>
          </div>
          <div class="chart-half">
            <h4>Saving Opportunities</h4>
            <div class="savings-stats">
              <div class="saving-item">
                <div class="saving-icon">
                  <i class="fas fa-temperature-high"></i>
                </div>
                <div class="saving-details">
                  <p class="saving-title">Climate Control</p>
                  <p class="saving-desc">
                    Reducing AC usage by 1hr/day could save:
                  </p>
                  <p class="saving-value">₱570/month</p>
                </div>
              </div>
              <div class="saving-item">
                <div class="saving-icon"><i class="fas fa-utensils"></i></div>
                <div class="saving-details">
                  <p class="saving-title">Kitchen Appliances</p>
                  <p class="saving-desc">Using energy efficient settings:</p>
                  <p class="saving-value">₱85/month</p>
                </div>
              </div>
              <div class="saving-item">
                <div class="saving-icon"><i class="fas fa-lightbulb"></i></div>
                <div class="saving-details">
                  <p class="saving-title">Lighting</p>
                  <p class="saving-desc">LED bulb upgrade could save:</p>
                  <p class="saving-value">₱45/month</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Per Appliance Comparison Chart -->
      <div class="card chart-card">
        <h3><i class="fas fa-exchange-alt"></i> Compare Individual Appliances</h3>
        <div class="chart-controls">
          <div class="chart-type-selector">
            <button class="chart-type-btn active" data-type="consumption">
              <i class="fas fa-bolt"></i> Consumption
            </button>
            <button class="chart-type-btn" data-type="cost">
              <i class="fas fa-peso-sign"></i> Cost
            </button>
            <button class="chart-type-btn" data-type="usage">
              <i class="fas fa-clock"></i> Usage Hours
            </button>
          </div>
        </div>
        <div class="chart-container" style="height: 400px;">
          <canvas id="applianceComparisonChart"></canvas>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: #3d5a80;"></span>
            <span class="legend-label">kWh per Month</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #e76f51;"></span>
            <span class="legend-label">Cost per Month (₱)</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background-color: #2a9d8f;"></span>
            <span class="legend-label">Daily Usage (hours)</span>
          </div>
        </div>
      </div>

      <!-- <div class="tab-container">
        <div class="tabs">
          <button class="tab active" data-tab="all">
            <i class="fas fa-border-all"></i> All Appliances
          </button>
          <button class="tab" data-tab="kitchen">
            <i class="fas fa-utensils"></i> Kitchen
          </button>
          <button class="tab" data-tab="entertainment">
            <i class="fas fa-tv"></i> Entertainment
          </button>
          <button class="tab" data-tab="climate">
            <i class="fas fa-temperature-high"></i> Climate Control
          </button>
          <button class="tab" data-tab="lighting">
            <i class="fas fa-lightbulb"></i> Lighting
          </button>
        </div>
      </div> -->

      <div class="card">
        <h3><i class="fas fa-plus-circle"></i> Add New Appliance</h3>
        <form id="applianceForm">
          <div class="form-row">
            <div class="form-group">
              <label for="applianceName">Appliance Name</label>
              <input
                type="text"
                id="applianceName"
                placeholder="e.g. Refrigerator"
                required
              />
            </div>
            <div class="form-group">
              <label for="applianceCategory">Category</label>
              <select id="applianceCategory" required>
                <option value="">Select Category</option>
                <option value="kitchen">Kitchen</option>
                <option value="entertainment">Entertainment</option>
                <option value="climate">Climate Control</option>
                <option value="lighting">Lighting</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="appliancePower">Power Consumption (Watts)</label>
              <input
                type="number"
                id="appliancePower"
                placeholder="e.g. 100"
                required
              />
            </div>
            <div class="form-group">
              <label for="dailyUsage">Daily Usage (Hours)</label>
              <input
                type="number"
                id="dailyUsage"
                placeholder="e.g. 5"
                step="0.1"
                required
              />
            </div>
            <div class="form-group">
              <label for="applianceStatus">Status</label>
              <select id="applianceStatus" required>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>

          <div style="text-align: right; margin-top: 20px">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i> Add Appliance
            </button>
          </div>
        </form>
      </div>

      <div class="tab-container">
        <div class="tabs">
          <button class="tab active" data-tab="all">
            <i class="fas fa-border-all"></i> All Appliances
          </button>
          <button class="tab" data-tab="kitchen">
            <i class="fas fa-utensils"></i> Kitchen
          </button>
          <button class="tab" data-tab="entertainment">
            <i class="fas fa-tv"></i> Entertainment
          </button>
          <button class="tab" data-tab="climate">
            <i class="fas fa-temperature-high"></i> Climate Control
          </button>
          <button class="tab" data-tab="lighting">
            <i class="fas fa-lightbulb"></i> Lighting
          </button>
        </div>
      </div>

      <div class="card">
        <h3><i class="fas fa-list"></i> My Appliances</h3>
        <table class="appliance-table">
          <thead>
            <tr>
              <th>Appliance Name</th>
              <th>Category</th>
              <th>Power (W)</th>
              <th>Daily Usage (h)</th>
              <th>Monthly kWh</th>
              <th>Est. Cost (₱)</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Air Conditioner</td>
              <td>
                <span class="appliance-category category-climate">Climate</span>
              </td>
              <td>950</td>
              <td>8</td>
              <td>228.0</td>
              <td>2,052.00</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Refrigerator</td>
              <td>
                <span class="appliance-category category-kitchen">Kitchen</span>
              </td>
              <td>150</td>
              <td>24</td>
              <td>108.0</td>
              <td>972.00</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>LED TV</td>
              <td>
                <span class="appliance-category category-entertainment"
                  >Entertainment</span
                >
              </td>
              <td>85</td>
              <td>6</td>
              <td>15.3</td>
              <td>137.70</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Ceiling Fan</td>
              <td>
                <span class="appliance-category category-climate">Climate</span>
              </td>
              <td>65</td>
              <td>10</td>
              <td>19.5</td>
              <td>175.50</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>LED Lights (5)</td>
              <td>
                <span class="appliance-category category-lighting"
                  >Lighting</span
                >
              </td>
              <td>40</td>
              <td>6</td>
              <td>7.2</td>
              <td>64.80</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Laptop</td>
              <td>
                <span class="appliance-category category-entertainment"
                  >Entertainment</span
                >
              </td>
              <td>60</td>
              <td>5</td>
              <td>9.0</td>
              <td>81.00</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Rice Cooker</td>
              <td>
                <span class="appliance-category category-kitchen">Kitchen</span>
              </td>
              <td>700</td>
              <td>1</td>
              <td>21.0</td>
              <td>189.00</td>
              <td>
                <span class="status-indicator status-active"></span> Active
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>Old Desktop PC</td>
              <td>
                <span class="appliance-category category-entertainment"
                  >Entertainment</span
                >
              </td>
              <td>200</td>
              <td>2</td>
              <td>12.0</td>
              <td>108.00</td>
              <td>
                <span class="status-indicator status-inactive"></span> Inactive
              </td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-edit"></i> Edit Appliance</h3>
          <span class="close">&times;</span>
        </div>
        <form id="editApplianceForm">
          <div class="form-row">
            <div class="form-group">
              <label for="editApplianceName">Appliance Name</label>
              <input
                type="text"
                id="editApplianceName"
                placeholder="e.g. Refrigerator"
                required
              />
            </div>
            <div class="form-group">
              <label for="editApplianceCategory">Category</label>
              <select id="editApplianceCategory" required>
                <option value="">Select Category</option>
                <option value="kitchen">Kitchen</option>
                <option value="entertainment">Entertainment</option>
                <option value="climate">Climate Control</option>
                <option value="lighting">Lighting</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="editAppliancePower">Power Consumption (Watts)</label>
              <input
                type="number"
                id="editAppliancePower"
                placeholder="e.g. 100"
                required
              />
            </div>
            <div class="form-group">
              <label for="editDailyUsage">Daily Usage (Hours)</label>
              <input
                type="number"
                id="editDailyUsage"
                placeholder="e.g. 5"
                step="0.1"
                required
              />
            </div>
            <div class="form-group">
              <label for="editApplianceStatus">Status</label>
              <select id="editApplianceStatus" required>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelEdit">
              Cancel
            </button>
            <button type="submit" class="btn btn-success">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>    <script>
      // Add console logging to debug chart initialization
      console.log('Script loaded');
      
      function initCharts() {
        console.log('initCharts function called');
        // Daily data - last 7 days
        const dailyLabels = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
        const dailyConsumption = [12.5, 11.8, 13.2, 10.9, 12.6, 14.3, 11.3];
        const dailyCost = dailyConsumption.map((value) => value * 9); // ₱9 per kWh

        // Weekly data - last 4 weeks
        const weeklyLabels = ["Week 1", "Week 2", "Week 3", "Week 4"];
        const weeklyConsumption = [82.4, 85.7, 89.2, 79.3];
        const weeklyCost = weeklyConsumption.map((value) => value * 9);

        // Monthly data - last 6 months
        const monthlyLabels = [
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
        ];
        const monthlyConsumption = [310, 345, 370, 352, 330, 357];
        const monthlyCost = monthlyConsumption.map((value) => value * 9);        // Create consumption chart
        const consumptionCanvas = document.getElementById("consumptionChart");
        if (!consumptionCanvas) {
          console.error("consumptionChart canvas element not found!");
          return null;
        }
        const consumptionCtx = consumptionCanvas.getContext("2d");
        console.log('Creating consumption chart');
        const consumptionChart = new Chart(consumptionCtx, {
          type: "line",
          data: {
            labels: dailyLabels,
            datasets: [{
              label: "Daily Consumption (kWh)",
              data: dailyConsumption,
              backgroundColor: "rgba(61, 90, 128, 0.2)",
              borderColor: "rgba(61, 90, 128, 1)",
              borderWidth: 2,
              tension: 0.4,
              pointBackgroundColor: "rgba(61, 90, 128, 1)",
              fill: true
            }],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "kWh",
                },
              },
            },
            plugins: {
              title: {
                display: true,
                text: "Daily Consumption (kWh)",
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return context.parsed.y.toFixed(1) + " kWh";
                  }
                }
              }
            },
          },
        });        // Create cost chart
        const costCanvas = document.getElementById("costChart");
        if (!costCanvas) {
          console.error("costChart canvas element not found!");
          return null;
        }
        const costCtx = costCanvas.getContext("2d");
        console.log('Creating cost chart');
        const costChart = new Chart(costCtx, {
          type: "bar",
          data: {
            labels: dailyLabels,
            datasets: [
              {
                label: "Daily Cost (₱)",
                data: dailyCost,
                backgroundColor: "rgba(231, 111, 81, 0.7)",
                borderColor: "#e76f51",
                borderWidth: 1,
                borderRadius: 4,
                hoverBackgroundColor: "rgba(231, 111, 81, 0.9)",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Cost (₱)",
                },
                grid: {
                  display: true,
                  color: "rgba(0, 0, 0, 0.05)"
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            },
            plugins: {
              title: {
                display: true,
                text: "Daily Cost (₱)",
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return "₱" + context.parsed.y.toFixed(2);
                  }
                }
              }
            },
          },        });
        
        // Create category pie chart
        const categoryCanvas = document.getElementById("categoryPieChart");
        if (!categoryCanvas) {
          console.error("categoryPieChart canvas element not found!");
          return null;
        }
        const categoryCtx = categoryCanvas.getContext("2d");
        console.log('Creating category pie chart');
        const categoryChart = new Chart(categoryCtx, {
          type: "doughnut",
          data: {
            labels: [
              "Climate Control",
              "Kitchen",
              "Entertainment",
              "Lighting",
              "Other",
            ],
            datasets: [
              {
                data: [247.5, 129.0, 36.3, 7.2, 0],
                backgroundColor: [
                  "#e76f51", // Climate
                  "#2a9d8f", // Kitchen
                  "#457b9d", // Entertainment
                  "#ee9b00", // Lighting
                  "#6c757d", // Other
                ],
                borderColor: "white",
                borderWidth: 2,
                hoverBorderWidth: 3,
                hoverOffset: 10,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '65%',
            plugins: {
              title: {
                display: true,
                text: "Consumption by Category (kWh)",
                font: {
                  size: 14,
                  weight: 'bold'
                }
              },
              legend: {
                position: "bottom",
                labels: {
                  padding: 15,
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const value = context.parsed;
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = ((value * 100) / total).toFixed(1) + '%';
                    return `${context.label}: ${value} kWh (${percentage})`;
                  }
                }
              }
            },
          },
        });

        // Handle period buttons for consumption chart
        document
          .querySelectorAll(".chart-card:nth-child(1) .chart-period-btn")
          .forEach((btn) => {
            btn.addEventListener("click", function () {
              document
                .querySelectorAll(".chart-card:nth-child(1) .chart-period-btn")
                .forEach((b) => b.classList.remove("active"));
              this.classList.add("active");

              let labels, data, title;
              const period = this.dataset.period;

              switch (period) {
                case "daily":
                  labels = dailyLabels;
                  data = dailyConsumption;
                  title = "Daily Consumption (kWh)";
                  break;
                case "weekly":
                  labels = weeklyLabels;
                  data = weeklyConsumption;
                  title = "Weekly Consumption (kWh)";
                  break;
                case "monthly":
                  labels = monthlyLabels;
                  data = monthlyConsumption;
                  title = "Monthly Consumption (kWh)";
                  break;
              }

              consumptionChart.data.labels = labels;
              consumptionChart.data.datasets[0].data = data;
              consumptionChart.options.plugins.title.text = title;
              consumptionChart.update();
            });
          });

        // Handle period buttons for cost chart
        document
          .querySelectorAll(".chart-card:nth-child(2) .chart-period-btn")
          .forEach((btn) => {
            btn.addEventListener("click", function () {
              document
                .querySelectorAll(".chart-card:nth-child(2) .chart-period-btn")
                .forEach((b) => b.classList.remove("active"));
              this.classList.add("active");

              let labels, data, title;
              const period = this.dataset.period;

              switch (period) {
                case "daily":
                  labels = dailyLabels;
                  data = dailyCost;
                  title = "Daily Cost (₱)";
                  break;
                case "weekly":
                  labels = weeklyLabels;
                  data = weeklyCost;
                  title = "Weekly Cost (₱)";
                  break;
                case "monthly":
                  labels = monthlyLabels;
                  data = monthlyCost;
                  title = "Monthly Cost (₱)";
                  break;
              }

              costChart.data.labels = labels;
              costChart.data.datasets[0].data = data;
              costChart.options.plugins.title.text = title;
              costChart.update();            });
          });
          
        // Create appliance comparison chart
        const applianceComparisonCanvas = document.getElementById("applianceComparisonChart");
        if (!applianceComparisonCanvas) {
          console.error("applianceComparisonChart canvas element not found!");
          return null;
        }
        
        const applianceComparisonCtx = applianceComparisonCanvas.getContext("2d");
        console.log('Creating appliance comparison chart');
        
        // Get appliance data from the table
        let applianceData;
        try {
          applianceData = getApplianceDataFromTable();
          console.log('Appliance data loaded:', applianceData);
        } catch (error) {
          console.error('Error loading appliance data:', error);
          applianceData = {
            labels: ["No Data"],
            consumptionData: [0],
            costData: [0],
            usageData: [0]
          };
        }
          
        const applianceComparisonChart = new Chart(applianceComparisonCtx, {
          type: "bar",
          data: {
            labels: applianceData.labels,
            datasets: [
              {
                label: "Monthly Consumption (kWh)",
                data: applianceData.consumptionData,
                backgroundColor: "rgba(61, 90, 128, 0.7)",
                borderColor: "rgba(61, 90, 128, 1)",
                borderWidth: 1,
                borderRadius: 4,
                barPercentage: 0.6,
                categoryPercentage: 0.8,
                hidden: false
              },
              {
                label: "Monthly Cost (₱)",
                data: applianceData.costData,
                backgroundColor: "rgba(231, 111, 81, 0.7)",
                borderColor: "rgba(231, 111, 81, 1)",
                borderWidth: 1,
                borderRadius: 4,
                barPercentage: 0.6,
                categoryPercentage: 0.8,
                hidden: true
              },
              {
                label: "Daily Usage (Hours)",
                data: applianceData.usageData,
                backgroundColor: "rgba(42, 157, 143, 0.7)",
                borderColor: "rgba(42, 157, 143, 1)",
                borderWidth: 1,
                borderRadius: 4,
                barPercentage: 0.6,
                categoryPercentage: 0.8,
                hidden: true
              }
            ],
          },
          options: {
            indexAxis: "y",
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                beginAtZero: true,
                grid: {
                  display: true,
                  color: "rgba(0, 0, 0, 0.05)"
                },
                ticks: {
                  callback: function(value) {
                    return value;
                  }
                }
              },
              y: {
                grid: {
                  display: false
                }
              }
            },
            plugins: {
              legend: {
                display: false
              },              tooltip: {
                callbacks: {
                  title: function(tooltipItems) {
                    // Return the appliance name as title
                    return tooltipItems[0].label || 'Unknown';
                  },
                  label: function(context) {
                    const datasetLabel = context.dataset.label || "";
                    const value = context.parsed.x;
                    if (isNaN(value)) {
                      return `${datasetLabel}: N/A`;
                    }
                    
                    if (datasetLabel.includes("Cost")) {
                      return `${datasetLabel}: ₱${value.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                    } else if (datasetLabel.includes("Consumption")) {
                      return `${datasetLabel}: ${value.toFixed(1)} kWh`;
                    } else {
                      return `${datasetLabel}: ${value} hours`;
                    }
                  },
                  footer: function(tooltipItems) {
                    // Add additional information based on data type
                    const dataset = tooltipItems[0].dataset;
                    const datasetLabel = dataset.label || "";
                    const value = tooltipItems[0].parsed.x;
                    
                    if (datasetLabel.includes("Cost")) {
                      return `Monthly electricity bill contribution`;
                    } else if (datasetLabel.includes("Consumption")) {
                      const percentOfTotal = applianceData.consumptionData.reduce((a, b) => a + b, 0);
                      if (percentOfTotal > 0) {
                        return `${((value / percentOfTotal) * 100).toFixed(1)}% of total consumption`;
                      }
                    } else if (datasetLabel.includes("Usage")) {
                      return `${(value * 30).toFixed(0)} hours per month`;
                    }
                    return '';
                  }
                },
                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                titleFont: {
                  weight: 'bold'
                },
                padding: 12,
                displayColors: true,
                borderColor: 'white',
                borderWidth: 1
              }
            },
          }
        });

        // Add event listeners for the chart type buttons
        document.querySelectorAll(".chart-type-btn").forEach(btn => {
          btn.addEventListener("click", function() {
            // Remove active class from all buttons
            document.querySelectorAll(".chart-type-btn").forEach(b => b.classList.remove("active"));
            // Add active class to clicked button
            this.classList.add("active");
            
            const chartType = this.dataset.type;
            
            // Hide all datasets
            applianceComparisonChart.data.datasets.forEach(dataset => {
              dataset.hidden = true;
            });
            
            // Show only the selected dataset
            if (chartType === "consumption") {
              applianceComparisonChart.data.datasets[0].hidden = false;
            } else if (chartType === "cost") {
              applianceComparisonChart.data.datasets[1].hidden = false;
            } else if (chartType === "usage") {
              applianceComparisonChart.data.datasets[2].hidden = false;
            }
            
            // Update the legend display
            updateChartLegend(chartType);
            
            // Update the chart
            applianceComparisonChart.update();
          });
        });
        
        // Initialize the legend display
        updateChartLegend("consumption");
        
        return {
          consumptionChart,
          costChart,
          categoryChart,
          applianceComparisonChart
        };
      }
      
      // Helper function to update the chart legend display
      function updateChartLegend(chartType) {
        const legendItems = document.querySelectorAll(".chart-legend .legend-item");
        legendItems.forEach(item => item.style.display = "none");
        
        if (chartType === "consumption") {
          legendItems[0].style.display = "flex";
        } else if (chartType === "cost") {
          legendItems[1].style.display = "flex";
        } else if (chartType === "usage") {
          legendItems[2].style.display = "flex";
        }
      }
        // Function to extract appliance data from the table
      function getApplianceDataFromTable() {
        console.log('Getting appliance data from table');
        const labels = [];
        const consumptionData = [];
        const costData = [];
        const usageData = [];
        
        const tableBody = document.querySelector(".appliance-table tbody");
        if (!tableBody) {
          console.error("Table body not found!");
          return {
            labels: ["No Data Available"],
            consumptionData: [0],
            costData: [0],
            usageData: [0]
          };
        }
        
        const rows = tableBody.querySelectorAll("tr");
        console.log(`Found ${rows.length} appliance rows`);        
        if (rows.length === 0) {
          console.log('No appliance rows found, using sample data');
          return sampleApplianceData;
        }
        
        rows.forEach((row, index) => {
          try {
            const applianceName = row.querySelector("td:nth-child(1)").textContent.trim();
            const monthlyKwhText = row.querySelector("td:nth-child(5)").textContent.trim();
            const monthlyKwh = parseFloat(monthlyKwhText);
            const costText = row.querySelector("td:nth-child(6)").textContent.trim();
            const cost = parseFloat(costText.replace('₱', '').replace(/,/g, ''));
            const usageText = row.querySelector("td:nth-child(4)").textContent.trim();
            const usage = parseFloat(usageText);
            
            // Only include active appliances
            const status = row.querySelector("td:nth-child(7)").textContent.trim();
            if (status.includes("Active")) {
              labels.push(applianceName);
              consumptionData.push(isNaN(monthlyKwh) ? 0 : monthlyKwh);
              costData.push(isNaN(cost) ? 0 : cost);
              usageData.push(isNaN(usage) ? 0 : usage);
            }
          } catch (error) {
            console.error(`Error processing row ${index}:`, error);          }
        });
        
        // If no active appliances were found, use sample data
        if (labels.length === 0) {
          console.log('No active appliances found, using sample data');
          return sampleApplianceData;
        }
        
        console.log('Returning appliance data:', { labels, consumptionData, costData, usageData });
        return {
          labels,
          consumptionData,
          costData,
          usageData
        };
      }      // Initialize charts when page loads
      let charts;
      
      // Sample data to use if table data isn't available
      const sampleApplianceData = {
        labels: ["Air Conditioner", "Refrigerator", "LED TV", "Ceiling Fan", "LED Lights", "Laptop"],
        consumptionData: [228.0, 108.0, 15.3, 19.5, 7.2, 9.0],
        costData: [2052.0, 972.0, 137.70, 175.50, 64.80, 81.0],
        usageData: [8, 24, 6, 10, 6, 5]
      };
      
      // Function to display fallback information when charts fail to load
      function displayFallbackInfo() {
        const chartContainers = document.querySelectorAll('.chart-container');
        chartContainers.forEach(container => {
          // Check if container already has an error message
          if (container.querySelector('.chart-error') || container.querySelector('canvas')) {
            return;
          }
          
          // Create and display static information
          const fallbackInfo = document.createElement('div');
          fallbackInfo.className = 'chart-fallback';
          fallbackInfo.innerHTML = `
            <div class="fallback-header">
              <i class="fas fa-chart-simple"></i> 
              <span>Chart Data Available</span>
            </div>
            <div class="fallback-content">
              <p>Visual representation currently unavailable.</p>
              <p>Total Consumption: 357 kWh</p>
              <p>Estimated Cost: ₱3,213.00</p>
              <button class="btn btn-primary reload-charts-btn">
                <i class="fas fa-sync"></i> Reload Charts
              </button>
            </div>
          `;
          
          container.appendChild(fallbackInfo);
        });
        
        // Add event listener to reload buttons
        document.querySelectorAll('.reload-charts-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            // Remove fallback displays
            document.querySelectorAll('.chart-fallback').forEach(el => el.remove());
            
            // Try to initialize charts again
            ensureChartJsLoaded(function() {
              try {
                charts = initCharts();
                console.log('Charts reinitialized successfully');
              } catch (error) {
                console.error('Error reinitializing charts:', error);
              }
            });
          });
        });
        
        // Add styles for fallback display
        const fallbackStyles = document.createElement('style');
        fallbackStyles.textContent = `
          .chart-fallback {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            padding: 20px;
            text-align: center;
            background-color: rgba(248, 249, 250, 0.8);
            border-radius: 8px;
            gap: 15px;
          }
          .fallback-header {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
          }
          .fallback-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
          }
          .fallback-content p {
            margin: 0;
          }
        `;
        document.head.appendChild(fallbackStyles);
      }
        // Make sure Chart.js is loaded correctly
      function ensureChartJsLoaded(callback) {
        if (window.Chart) {
          console.log('Chart.js is loaded');
          callback();
          return;
        } 
        
        console.error('Chart.js is not loaded! Attempting to load it now...');
        
        // Try multiple CDNs for better reliability
        const cdnUrls = [
          'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js',
          'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js',
          'https://unpkg.com/chart.js@3.9.1/dist/chart.min.js'
        ];
        
        // Show loading indicator in chart containers
        const chartContainers = document.querySelectorAll('.chart-container');
        chartContainers.forEach(container => {
          const loadingIndicator = document.createElement('div');
          loadingIndicator.className = 'chart-loading';
          loadingIndicator.innerHTML = `
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Charts...</div>
          `;
          container.appendChild(loadingIndicator);
        });
        
        // Add loading spinner styles
        const spinnerStyles = document.createElement('style');
        spinnerStyles.textContent = `
          .chart-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
          }
          .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
          }
          .loading-text {
            color: var(--primary-color);
            font-weight: 500;
          }
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `;
        document.head.appendChild(spinnerStyles);
        
        // Try each CDN until one works
        function tryLoadFromCDN(index) {
          if (index >= cdnUrls.length) {
            console.error('All CDNs failed to load Chart.js');
            
            // Remove loading indicators
            document.querySelectorAll('.chart-loading').forEach(el => el.remove());
            
            // Display fallback information
            displayFallbackInfo();
            return;
          }
          
          const chartScript = document.createElement('script');
          chartScript.src = cdnUrls[index];
          chartScript.onload = function() {
            console.log('Chart.js loaded dynamically from ' + cdnUrls[index]);
            
            // Remove loading indicators
            document.querySelectorAll('.chart-loading').forEach(el => el.remove());
            
            callback();
          };
          chartScript.onerror = function() {
            console.error('Failed to load Chart.js from ' + cdnUrls[index]);
            // Try next CDN
            tryLoadFromCDN(index + 1);
          };
          document.head.appendChild(chartScript);
        }
        
        // Start trying from the first CDN
        tryLoadFromCDN(0);
      }window.addEventListener("DOMContentLoaded", function () {
        console.log('DOMContentLoaded event fired');
        updateTotals();
        
        // Check if all canvas elements exist
        const canvasIds = ["consumptionChart", "costChart", "categoryPieChart", "applianceComparisonChart"];
        let allCanvasExist = true;
        
        canvasIds.forEach(id => {
          const canvas = document.getElementById(id);
          if (!canvas) {
            console.error(`Canvas element with id ${id} not found!`);
            allCanvasExist = false;
          } else {
            console.log(`Canvas element ${id} found`);
          }
        });
        
        if (!allCanvasExist) {
          console.warn('Not all canvas elements were found. Some charts may not display properly.');
        }
        
        // Ensure Chart.js is loaded before initializing charts
        ensureChartJsLoaded(function() {
          try {
            charts = initCharts();
            console.log('Charts initialized successfully:', charts);
          } catch (error) {
            console.error('Error initializing charts:', error);
            // Display error message for users
            canvasIds.forEach(id => {
              const canvas = document.getElementById(id);
              if (canvas) {
                const container = canvas.parentElement;
                if (container) {
                  const errorMsg = document.createElement('div');
                  errorMsg.className = 'chart-error';
                  errorMsg.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Unable to display chart. Please refresh the page.';
                  errorMsg.style.cssText = 'color: #e63946; padding: 20px; text-align: center; font-weight: bold;';
                  container.appendChild(errorMsg);
                }
              }
            });
          }
        });

        // Update pie chart when appliances change
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (
              (mutation.type === "childList" &&
                mutation.target.classList.contains("appliance-table")) ||
              mutation.target.tagName === "TBODY"
            ) {
              updateCategoryChart();
            }
          });
        });

        // Watch for table changes
        observer.observe(document.querySelector(".appliance-table tbody"), {
          childList: true,
          subtree: true,
        });
      });      // Update the pie chart based on current appliance data
      function updateCategoryChart() {
        try {
          if (!charts || !charts.categoryChart) {
            console.error('Category chart not initialized');
            return;
          }
          
          console.log('Updating category chart...');

          let climate = 0,
            kitchen = 0,
            entertainment = 0,
            lighting = 0,
            other = 0;
            
          try {
            document
              .querySelectorAll(".appliance-table tbody tr")
              .forEach((row) => {
                // Make sure row has all cells we need
                if (row.cells.length < 7) {
                  console.warn('Invalid table row structure, missing cells');
                  return;
                }
                
                // Get status
                const statusCell = row.querySelector("td:nth-child(7)");
                if (!statusCell) {
                  console.warn('Status cell not found in row');
                  return;
                }
                
                const status = statusCell.textContent.trim();
                if (!status.includes("Active")) return;

                // Get monthly kWh
                const kwhCell = row.querySelector("td:nth-child(5)");
                if (!kwhCell) {
                  console.warn('kWh cell not found in row');
                  return;
                }
                
                const monthlyKwh = parseFloat(kwhCell.textContent);
                if (isNaN(monthlyKwh)) {
                  console.warn('Invalid kWh value:', kwhCell.textContent);
                  return;
                }
                
                // Get category
                const categoryCell = row.querySelector("td:nth-child(2)");
                if (!categoryCell) {
                  console.warn('Category cell not found in row');
                  return;
                }
                
                const category = categoryCell.textContent.trim().toLowerCase();

                if (category.includes("climate")) {
                  climate += monthlyKwh;
                } else if (category.includes("kitchen")) {
                  kitchen += monthlyKwh;
                } else if (category.includes("entertainment")) {
                  entertainment += monthlyKwh;
                } else if (category.includes("lighting")) {
                  lighting += monthlyKwh;
                } else {
                  other += monthlyKwh;
                }
              });
          } catch (error) {
            console.error('Error processing table rows:', error);
            // Use default values if there's an error
            climate = 247.5;
            kitchen = 129.0;
            entertainment = 36.3;
            lighting = 7.2;
            other = 0;
          }

          // Update chart data
          charts.categoryChart.data.datasets[0].data = [
            climate,
            kitchen,
            entertainment,
            lighting,
            other,
          ];
          
          // Update the title to include total
          const totalKwh = climate + kitchen + entertainment + lighting + other;
          charts.categoryChart.options.plugins.title.text = 
            `Consumption by Category (Total: ${totalKwh.toFixed(1)} kWh)`;
          
          // Update saving opportunities based on new data
          updateSavingOpportunities(climate, kitchen, lighting, totalKwh);
          
          // Update the chart
          charts.categoryChart.update();
          console.log('Category chart updated successfully');
          
          // Also update the appliance comparison chart
          updateApplianceComparisonChart();
        } catch (error) {
          console.error('Error updating category chart:', error);
          
          // Attempt to recover by recreating the chart
          try {
            const categoryCanvas = document.getElementById("categoryPieChart");
            if (categoryCanvas && charts) {
              charts.categoryChart.destroy();
              const categoryCtx = categoryCanvas.getContext("2d");
              
              // Create category pie chart with default data
              charts.categoryChart = new Chart(categoryCtx, {
                type: "doughnut",
                data: {
                  labels: [
                    "Climate Control",
                    "Kitchen",
                    "Entertainment",
                    "Lighting",
                    "Other",
                  ],
                  datasets: [
                    {
                      data: [247.5, 129.0, 36.3, 7.2, 0],
                      backgroundColor: [
                        "#e76f51", // Climate
                        "#2a9d8f", // Kitchen
                        "#457b9d", // Entertainment
                        "#ee9b00", // Lighting
                        "#6c757d", // Other
                      ],
                      borderColor: "white",
                      borderWidth: 2,
                      hoverOffset: 10,
                    },
                  ],
                },
                options: {
                  responsive: true,
                  maintainAspectRatio: false,
                  cutout: '65%',
                  plugins: {
                    title: {
                      display: true,
                      text: "Consumption by Category (kWh)",
                      font: {
                        size: 14,
                        weight: 'bold'
                      }
                    },
                    legend: {
                      position: "bottom",
                      labels: {
                        padding: 15,
                        usePointStyle: true,
                        pointStyle: 'circle'
                      }
                    }
                  },
                },
              });
              
              console.log('Category chart recreated');
            }
          } catch (recoveryError) {
            console.error('Failed to recover category chart:', recoveryError);
          }
        }
      }
        // Update the appliance comparison chart when data changes
      function updateApplianceComparisonChart() {
        try {
          if (!charts || !charts.applianceComparisonChart) {
            console.error('Appliance comparison chart not initialized');
            return;
          }
          
          console.log('Updating appliance comparison chart...');
          
          // Get updated appliance data
          const applianceData = getApplianceDataFromTable();
          
          // Update chart data
          charts.applianceComparisonChart.data.labels = applianceData.labels;
          charts.applianceComparisonChart.data.datasets[0].data = applianceData.consumptionData;
          charts.applianceComparisonChart.data.datasets[1].data = applianceData.costData;
          charts.applianceComparisonChart.data.datasets[2].data = applianceData.usageData;
          
          // Update the chart
          charts.applianceComparisonChart.update();
          
          console.log('Appliance comparison chart updated successfully');
          
          // Show update notification if not initial load
          if (window.chartUpdateNotification) {
            // Create toast notification
            const toastMessage = document.createElement("div");
            toastMessage.className = "toast-message success";
            toastMessage.innerHTML = '<i class="fas fa-chart-bar"></i> Charts updated with new data';
            document.body.appendChild(toastMessage);
            
            // Remove toast after 2 seconds
            setTimeout(() => {
              toastMessage.style.opacity = "0";
              setTimeout(() => toastMessage.remove(), 500);
            }, 2000);
          } else {
            // Set flag for future updates
            window.chartUpdateNotification = true;
          }
        } catch (error) {
          console.error('Error updating appliance comparison chart:', error);
        }
      }
      
      // Update the saving opportunities based on consumption data
      function updateSavingOpportunities(climate, kitchen, lighting, totalKwh) {
        // Climate control savings - based on reducing usage by 1hr/day
        if (climate > 0) {
          const acUsage = climate * 0.8; // Assume 80% of climate is AC
          const acHourly = acUsage / 30 / 8; // Estimated hourly consumption
          const climateSavings = Math.round(acHourly * 30 * 9); // 1hr/day * 30 days * ₱9 rate
          document.querySelector(".saving-item:nth-child(1) .saving-value").textContent =
            "₱" + climateSavings + "/month";
        }
        
        // Kitchen appliance savings - based on efficient settings (about 10%)
        if (kitchen > 0) {
          const kitchenSavings = Math.round(kitchen * 0.1 * 9); // 10% savings * ₱9 rate
          document.querySelector(".saving-item:nth-child(2) .saving-value").textContent =
            "₱" + kitchenSavings + "/month";
        }
        
        // Lighting savings - based on LED upgrade (about 70%)
        if (lighting > 0) {
          const lightingSavings = Math.round(lighting * 0.7 * 9); // 70% savings * ₱9 rate
          document.querySelector(".saving-item:nth-child(3) .saving-value").textContent =
            "₱" + lightingSavings + "/month";
        }
      }// Calculate total consumption and cost
      function updateTotals() {
        let totalKwh = 0;
        let totalCost = 0;
        const activeAppliances = [];

        document
          .querySelectorAll(".appliance-table tbody tr")
          .forEach((row) => {
            const status = row
              .querySelector("td:nth-child(7)")
              .textContent.trim();
            if (status.includes("Active")) {
              const monthlyKwh = parseFloat(
                row.querySelector("td:nth-child(5)").textContent
              );
              const cost = parseFloat(
                row
                  .querySelector("td:nth-child(6)")
                  .textContent.replace("₱", "")
                  .replace(",", "")
              );

              totalKwh += monthlyKwh;
              totalCost += cost;
              activeAppliances.push(row);
            }
          });

        // Update the stats display
        document.querySelector(".summary-stats .stat-card:nth-child(1) .stat-info p").textContent =
          activeAppliances.length.toString();
        document.querySelector(".summary-stats .stat-card:nth-child(2) .stat-info p").textContent =
          Math.round(totalKwh) + " kWh";
        document.querySelector(".summary-stats .stat-card:nth-child(3) .stat-info p").textContent =
          "₱" + totalCost.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

        // Also update saving opportunities
        const climatePercentage = Math.round((247.5 / totalKwh) * 100);
        if (climatePercentage > 30) {
          const climateSavings = Math.round(totalCost * 0.15);
          document.querySelector(".saving-item:nth-child(1) .saving-value").textContent =
            "₱" + climateSavings.toLocaleString('en-US') + "/month";
        }

        return {
          totalKwh,
          totalCost,
          activeCount: activeAppliances.length,
        };
      }

      // Run this on page load
      //   window.addEventListener("DOMContentLoaded", function () {
      //     updateTotals();
      //   });

      // Tab switching
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", function () {
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          this.classList.add("active");

          const category = this.dataset.tab;
          const rows = document.querySelectorAll(".appliance-table tbody tr");

          if (category === "all") {
            rows.forEach((row) => (row.style.display = ""));
          } else {
            rows.forEach((row) => {
              const categoryCell = row
                .querySelector("td:nth-child(2)")
                .textContent.toLowerCase();
              if (categoryCell.includes(category)) {
                row.style.display = "";
              } else {
                row.style.display = "none";
              }
            });
          }
        });
      });

      // Modal handling
      const modal = document.getElementById("editModal");
      const editButtons = document.querySelectorAll(".edit-btn");
      const closeBtn = document.querySelector(".close");
      const cancelBtn = document.getElementById("cancelEdit");      // Open modal when edit button is clicked
      editButtons.forEach((button) => {
        button.addEventListener("click", function () {
          // First remove the data-editing attribute from all buttons
          document.querySelectorAll(".edit-btn").forEach(btn => {
            btn.removeAttribute("data-editing");
          });
          
          // Mark this button as the one being used for editing
          this.setAttribute("data-editing", "true");
          
          // Display the modal
          modal.style.display = "block";

          const row = this.closest("tr");
          document.getElementById("editApplianceName").value =
            row.cells[0].textContent.trim();

          const categoryText = row.cells[1].textContent.trim();
          const categorySelect = document.getElementById(
            "editApplianceCategory"
          );

          if (categoryText.includes("Kitchen")) {
            categorySelect.value = "kitchen";
          } else if (categoryText.includes("Entertainment")) {
            categorySelect.value = "entertainment";
          } else if (categoryText.includes("Climate")) {
            categorySelect.value = "climate";
          } else if (categoryText.includes("Lighting")) {
            categorySelect.value = "lighting";
          } else {
            categorySelect.value = "other";
          }

          document.getElementById("editAppliancePower").value =
            row.cells[2].textContent.trim();
          document.getElementById("editDailyUsage").value =
            row.cells[3].textContent.trim();
          document.getElementById("editApplianceStatus").value =
            row.cells[6].textContent.trim().toLowerCase().includes("active")
              ? "active"
              : "inactive";
        });
      });

      // Close modal
      closeBtn.addEventListener("click", function () {
        modal.style.display = "none";
      });

      cancelBtn.addEventListener("click", function () {
        modal.style.display = "none";
      });

      // Close modal if clicked outside
      window.addEventListener("click", function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      });

      // Delete button handling     
       document.querySelectorAll(".delete-btn").forEach((button) => {
        button.addEventListener("click", function () {
          if (confirm("Are you sure you want to delete this appliance?")) {
            this.closest("tr").remove();
            updateTotals();
            updateCategoryChart();
            updateApplianceComparisonChart();
            
            // Show toast notification instead of alert
            const toastMessage = document.createElement("div");
            toastMessage.className = "toast-message success";
            toastMessage.innerHTML = `<i class="fas fa-check-circle"></i> Appliance deleted successfully!`;
            document.body.appendChild(toastMessage);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
              toastMessage.style.opacity = "0";
              setTimeout(() => toastMessage.remove(), 500);
            }, 3000);
          }
        });
      });// Form submission
      document
        .getElementById("applianceForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          try {
            // Get form values
            const name = document.getElementById("applianceName").value.trim();
            const category = document.getElementById("applianceCategory").value;
            const power = parseFloat(document.getElementById("appliancePower").value);
            const usage = parseFloat(document.getElementById("dailyUsage").value);
            const status = document.getElementById("applianceStatus").value;

            // Form validation
            if (!name) {
              throw new Error("Please enter an appliance name");
            }
            if (!category) {
              throw new Error("Please select a category");
            }
            if (isNaN(power) || power <= 0) {
              throw new Error("Please enter a valid power value greater than 0");
            }
            if (isNaN(usage) || usage <= 0 || usage > 24) {
              throw new Error("Please enter a valid usage value between 0 and 24 hours");
            }

            // Calculate monthly kWh and cost
            const monthlyKwh = ((power * usage * 30) / 1000).toFixed(1);
            const monthlyCost = (monthlyKwh * 9).toLocaleString('en-US', {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2
            }); // Using ₱9 per kWh rate

            // Create new row for the table
            const tbody = document.querySelector(".appliance-table tbody");
            const newRow = tbody.insertRow(0); // Insert at the top

            // Insert cells with data
            newRow.innerHTML = `
              <td>${name}</td>
              <td><span class="appliance-category category-${category}">${getCategoryName(
              category
            )}</span></td>
              <td>${power}</td>
              <td>${usage}</td>
              <td>${monthlyKwh}</td>
              <td>${monthlyCost}</td>
              <td><span class="status-indicator status-${status}"></span> ${
              status === "active" ? "Active" : "Inactive"
            }</td>
              <td>
                <div class="actions">
                  <button class="action-btn edit-btn" title="Edit">
                    <i class="fas fa-pen"></i>
                  </button>
                  <button class="action-btn delete-btn" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            `;

            // Add event listeners to new buttons
            const newEditBtn = newRow.querySelector(".edit-btn");
            const newDeleteBtn = newRow.querySelector(".delete-btn");

            newEditBtn.addEventListener("click", function () {
              modal.style.display = "block";
              // Populate form with row data
              document.getElementById("editApplianceName").value = name;
              document.getElementById("editApplianceCategory").value = category;
              document.getElementById("editAppliancePower").value = power;
              document.getElementById("editDailyUsage").value = usage;
              document.getElementById("editApplianceStatus").value = status;
            });            newDeleteBtn.addEventListener("click", function () {
              if (confirm("Are you sure you want to delete this appliance?")) {
                newRow.remove();
                updateTotals();
                updateCategoryChart();
                updateApplianceComparisonChart();
                
                // Show toast notification instead of alert
                const toastMessage = document.createElement("div");
                toastMessage.className = "toast-message success";
                toastMessage.innerHTML = `<i class="fas fa-check-circle"></i> Appliance deleted successfully!`;
                document.body.appendChild(toastMessage);
                
                // Remove toast after 3 seconds
                setTimeout(() => {
                  toastMessage.style.opacity = "0";
                  setTimeout(() => toastMessage.remove(), 500);
                }, 3000);
              }
            });            // Reset form
            this.reset();

            // Update totals and charts
            updateTotals();
            updateCategoryChart();
            updateApplianceComparisonChart();

            // Show success message with toast notification
            const toastMessage = document.createElement("div");
            toastMessage.className = "toast-message success";
            toastMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${name} added successfully!`;
            document.body.appendChild(toastMessage);
            
            // Add toast styles if they don't exist
            if (!document.getElementById("toast-styles")) {
              const toastStyles = document.createElement("style");
              toastStyles.id = "toast-styles";
              toastStyles.textContent = `
                .toast-message {
                  position: fixed;
                  bottom: 20px;
                  right: 20px;
                  padding: 12px 20px;
                  border-radius: 6px;
                  color: white;
                  font-weight: 500;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  box-shadow: 0 3px 10px rgba(0,0,0,0.15);
                  z-index: 9999;
                  transition: opacity 0.5s;
                }
                .toast-message.success {
                  background-color: var(--success-color);
                }
                .toast-message.error {
                  background-color: var(--danger-color);
                }
                .toast-message i {
                  font-size: 1.2rem;
                }
              `;
              document.head.appendChild(toastStyles);
            }
            
            // Remove toast after 3 seconds
            setTimeout(() => {
              toastMessage.style.opacity = "0";
              setTimeout(() => toastMessage.remove(), 500);
            }, 3000);
            
          } catch (error) {
            // Show error toast notification
            const errorToast = document.createElement("div");
            errorToast.className = "toast-message error";
            errorToast.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${error.message}`;
            document.body.appendChild(errorToast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
              errorToast.style.opacity = "0";
              setTimeout(() => errorToast.remove(), 500);
            }, 3000);
          }
        });      // Edit form submission
      document
        .getElementById("editApplianceForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          try {
            // Get the edited values
            const name = document.getElementById("editApplianceName").value.trim();
            const category = document.getElementById("editApplianceCategory").value;
            const power = parseFloat(document.getElementById("editAppliancePower").value);
            const usage = parseFloat(document.getElementById("editDailyUsage").value);
            const status = document.getElementById("editApplianceStatus").value;

            // Form validation
            if (!name) {
              throw new Error("Please enter an appliance name");
            }
            if (!category) {
              throw new Error("Please select a category");
            }
            if (isNaN(power) || power <= 0) {
              throw new Error("Please enter a valid power value greater than 0");
            }
            if (isNaN(usage) || usage <= 0 || usage > 24) {
              throw new Error("Please enter a valid usage value between 0 and 24 hours");
            }

            // Calculate monthly kWh and cost
            const monthlyKwh = ((power * usage * 30) / 1000).toFixed(1);
            const monthlyCost = (monthlyKwh * 9).toLocaleString('en-US', {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2
            }); // Using ₱9 per kWh rate

            // Store the current active button
            let currentEditButton = null;
            document.querySelectorAll(".edit-btn").forEach(btn => {
              if (btn.getAttribute("data-editing") === "true") {
                currentEditButton = btn;
              }
            });

            // Find the row being edited
            const rowToEdit = currentEditButton ? currentEditButton.closest("tr") : null;

            if (rowToEdit) {
              // Update the row with new values
              rowToEdit.cells[0].textContent = name;
              rowToEdit.cells[1].innerHTML = `<span class="appliance-category category-${category}">${getCategoryName(
                category
              )}</span>`;
              rowToEdit.cells[2].textContent = power;
              rowToEdit.cells[3].textContent = usage;
              rowToEdit.cells[4].textContent = monthlyKwh;
              rowToEdit.cells[5].textContent = monthlyCost;
              rowToEdit.cells[6].innerHTML = `<span class="status-indicator status-${status}"></span> ${
                status === "active" ? "Active" : "Inactive"
              }`;              // Update totals and charts
              updateTotals();
              updateCategoryChart();
              updateApplianceComparisonChart();
              
              // Clear data-editing attribute
              if (currentEditButton) {
                currentEditButton.removeAttribute("data-editing");
              }
              
              // Show success toast notification
              const toastMessage = document.createElement("div");
              toastMessage.className = "toast-message success";
              toastMessage.innerHTML = `<i class="fas fa-check-circle"></i> ${name} updated successfully!`;
              document.body.appendChild(toastMessage);
              
              // Remove toast after 3 seconds
              setTimeout(() => {
                toastMessage.style.opacity = "0";
                setTimeout(() => toastMessage.remove(), 500);
              }, 3000);
              
              // Close the modal
              modal.style.display = "none";
            } else {
              throw new Error("Could not find the appliance to edit");
            }
          } catch (error) {
            // Show error toast notification
            const errorToast = document.createElement("div");
            errorToast.className = "toast-message error";
            errorToast.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${error.message}`;
            document.body.appendChild(errorToast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
              errorToast.style.opacity = "0";
              setTimeout(() => errorToast.remove(), 500);
            }, 3000);
          }
        });

      // Helper function to get category name
      function getCategoryName(category) {
        switch (category) {
          case "kitchen":
            return "Kitchen";
          case "entertainment":
            return "Entertainment";
          case "climate":
            return "Climate";
          case "lighting":
            return "Lighting";
          default:
            return "Other";
        }
      }    </script>
    
    <!-- Additional script to ensure charts are loaded correctly -->
    <script>
      // Extra check to make sure charts are initialized after a short delay
      window.addEventListener('load', function() {
        setTimeout(function() {
          console.log('Final chart check...');
          if (!charts || !charts.consumptionChart || !charts.applianceComparisonChart) {
            console.log('Charts not initialized properly, retrying...');
            try {
              ensureChartJsLoaded(function() {
                charts = initCharts();
                console.log('Charts re-initialized on second attempt');
              });
            } catch(e) {
              console.error('Failed to initialize charts on second attempt:', e);
              
              // Show error messages in chart containers
              const canvasIds = ["consumptionChart", "costChart", "categoryPieChart", "applianceComparisonChart"];
              canvasIds.forEach(id => {
                const canvas = document.getElementById(id);
                if (canvas) {
                  const container = canvas.parentElement;
                  if (container) {
                    // Check if error message already exists
                    if (!container.querySelector('.chart-error')) {
                      const errorMsg = document.createElement('div');
                      errorMsg.className = 'chart-error';
                      errorMsg.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Unable to display chart. Please refresh the page.';
                      container.appendChild(errorMsg);
                    }
                  }
                }
              });
            }
          } else {
            console.log('Charts are properly initialized');
          }
        }, 1000); // Wait 1 second after page load
      });
    </script>
  </body>
</html>
